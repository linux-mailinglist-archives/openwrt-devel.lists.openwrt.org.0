Return-Path: <openwrt-devel-bounces+lists+openwrt-devel=lfdr.de@lists.openwrt.org>
X-Original-To: lists+openwrt-devel@lfdr.de
Delivered-To: lists+openwrt-devel@lfdr.de
Received: from bombadil.infradead.org (bombadil.infradead.org [IPv6:2607:7c80:54:e::133])
	by mail.lfdr.de (Postfix) with ESMTPS id A4F7912F25E
	for <lists+openwrt-devel@lfdr.de>; Fri,  3 Jan 2020 01:47:46 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
	d=lists.infradead.org; s=bombadil.20170209; h=Sender:
	Content-Transfer-Encoding:Content-Type:Cc:List-Subscribe:List-Help:List-Post:
	List-Archive:List-Unsubscribe:List-Id:Subject:MIME-Version:References:
	In-Reply-To:Message-Id:Date:To:From:Reply-To:Content-ID:Content-Description:
	Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:
	List-Owner; bh=/cgFNwsxkdXSMad8BppdhkM3d7T4hh2+8K/MIpsA2eU=; b=eaBtzKWAM7IpSm
	34GT3bg4q2E48v5czvCR4bQ4K0JTw/qKLi2Lq65qSEnVBVLc8G31+8FldH8Ig1aXASCbnz+L+HMC0
	zcrvDNZHYLDysUHPcdotSmsT8K3R1084fY40PdX2cjCBDEx+ph9ZaYC9CWB5DDqZxjY3DOvFWH4xl
	3W/oUfHBEUl7cOBiYEqkeuR/H1hL3JK3zfGzzHaLS7hpwIUJV1h+2cYx6xn3fUbMP7+wPrQcy8iAO
	2lZh8nb/UYn2NsggSAlqzJkx1AkRyi6Fdd5dI2KW4UPedHYjN7kLbhK0EcoIDJPY03BXwlCKi6dGz
	/I0k+t3FcsN5SXCUrVag==;
Received: from localhost ([127.0.0.1] helo=bombadil.infradead.org)
	by bombadil.infradead.org with esmtp (Exim 4.92.3 #3 (Red Hat Linux))
	id 1inB7v-0000hp-2q; Fri, 03 Jan 2020 00:47:43 +0000
Received: from smtp-out.xnet.cz ([178.217.244.18])
 by bombadil.infradead.org with esmtps (Exim 4.92.3 #3 (Red Hat Linux))
 id 1inB70-0008D7-Mq
 for openwrt-devel@lists.openwrt.org; Fri, 03 Jan 2020 00:46:50 +0000
Received: from meh.true.cz (meh.true.cz [108.61.167.218])
 (Authenticated sender: petr@true.cz)
 by smtp-out.xnet.cz (Postfix) with ESMTPSA id 09FFA36CE;
 Fri,  3 Jan 2020 01:46:44 +0100 (CET)
Received: by meh.true.cz (OpenSMTPD) with ESMTP id 5f92229e;
 Fri, 3 Jan 2020 01:46:32 +0100 (CET)
From: =?UTF-8?q?Petr=20=C5=A0tetiar?= <ynezz@true.cz>
To: openwrt-devel@lists.openwrt.org
Date: Fri,  3 Jan 2020 01:46:37 +0100
Message-Id: <20200103004638.16307-4-ynezz@true.cz>
In-Reply-To: <20200103004638.16307-1-ynezz@true.cz>
References: <20200103004638.16307-1-ynezz@true.cz>
MIME-Version: 1.0
X-CRM114-Version: 20100106-BlameMichelson ( TRE 0.8.0 (BSD) ) MR-646709E3 
X-CRM114-CacheID: sfid-20200102_164646_920238_9CBD67C9 
X-CRM114-Status: GOOD (  13.62  )
X-Spam-Score: 0.0 (/)
X-Spam-Report: SpamAssassin version 3.4.2 on bombadil.infradead.org summary:
 Content analysis details:   (0.0 points)
 pts rule name              description
 ---- ---------------------- --------------------------------------------------
 -0.0 RCVD_IN_DNSWL_NONE     RBL: Sender listed at https://www.dnswl.org/,
 no trust [178.217.244.18 listed in list.dnswl.org]
 0.0 SPF_NONE               SPF: sender does not publish an SPF Record
 0.0 SPF_HELO_NONE          SPF: HELO does not publish an SPF Record
Subject: [OpenWrt-Devel] [PATCH procd 3/4] system: sysupgrade: rework
 firmware validation
X-BeenThere: openwrt-devel@lists.openwrt.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: <openwrt-devel.lists.openwrt.org>
List-Unsubscribe: <http://lists.infradead.org/mailman/options/openwrt-devel>, 
 <mailto:openwrt-devel-request@lists.openwrt.org?subject=unsubscribe>
List-Archive: <http://lists.infradead.org/pipermail/openwrt-devel/>
List-Post: <mailto:openwrt-devel@lists.openwrt.org>
List-Help: <mailto:openwrt-devel-request@lists.openwrt.org?subject=help>
List-Subscribe: <http://lists.infradead.org/mailman/listinfo/openwrt-devel>,
 <mailto:openwrt-devel-request@lists.openwrt.org?subject=subscribe>
Cc: =?UTF-8?q?Rafa=C5=82=20Mi=C5=82ecki?= <rafal@milecki.pl>,
 =?UTF-8?q?Petr=20=C5=A0tetiar?= <ynezz@true.cz>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Sender: "openwrt-devel" <openwrt-devel-bounces@lists.openwrt.org>
Errors-To: openwrt-devel-bounces+lists+openwrt-devel=lfdr.de@lists.openwrt.org

Rml4ZXMgZm9sbG93aW5nIGRlZmljaWVuY2llczoKCiAqIHVuaGFuZGxlZCByZWFkKCkgZXJyb3Jz
CiAqIGV2ZXJ5dGhpbmcgYnVuZGxlZCBpbiBvbmUgbG9uZyBmdW5jdGlvbiwgd2hpY2ggaXMgaGFy
ZCB0byBmb2xsb3cgYW5kCiAgIHJlYXNvbiBhYm91dAogKiBKU09OIHBhcnNlciBlcnJvcnMgYXJl
IGJlaW5nIGlnbm9yZWQsIGFueXRoaW5nIGVsc2UgdGhlbgogICBqc29uX3Rva2VuZXJfY29udGlu
dWUgaXMgZmF0YWwgZXJyb3IKICogSlNPTiBwYXJzZXIgZXJyb3JzIGFyZSBiZWluZyBvdXRwdXQg
dG8gc3RkZXJyLCB0aHVzIGludmlzaWJsZSB2aWEgU1NICiAqIHZhbGlkYXRlX2Zpcm13YXJlX2lt
YWdlX2NhbGwgY2FuIGZhaWwgYXQgYSBsb3Qgb2YgcGxhY2VzLCBidXQgd2UganVzdAogICBnZXQg
b25lIGdlbmVyaWMgIkZpcm13YXJlIGltYWdlIGNvdWxkbid0IGJlIHZhbGlkYXRlZCIgc28gaXQn
cyBoYXJkCiAgIHRvIGRlYnVnCgpDYzogUmFmYcWCIE1pxYJlY2tpIDxyYWZhbEBtaWxlY2tpLnBs
PgpTaWduZWQtb2ZmLWJ5OiBQZXRyIMWgdGV0aWFyIDx5bmV6ekB0cnVlLmN6PgotLS0KIHN5c3Rl
bS5jIHwgMTcwICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0t
LS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxMjMgaW5zZXJ0aW9ucygrKSwgNDcgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEvc3lzdGVtLmMgYi9zeXN0ZW0uYwppbmRleCA1Y2Q4OGUwZDgyMjcu
LmYwMTk4YTViMjBiOCAxMDA2NDQKLS0tIGEvc3lzdGVtLmMKKysrIGIvc3lzdGVtLmMKQEAgLTM3
LDYgKzM3LDEyIEBAIHN0YXRpYyBzdHJ1Y3QgYmxvYl9idWYgYjsKIHN0YXRpYyBpbnQgbm90aWZ5
Owogc3RhdGljIHN0cnVjdCB1YnVzX2NvbnRleHQgKl9jdHg7CiAKK2VudW0gdmpzb25fc3RhdGUg
eworCVZKU09OX0VSUk9SLAorCVZKU09OX0NPTlRJTlVFLAorCVZKU09OX1NVQ0NFU1MsCit9Owor
CiBzdGF0aWMgaW50IHN5c3RlbV9ib2FyZChzdHJ1Y3QgdWJ1c19jb250ZXh0ICpjdHgsIHN0cnVj
dCB1YnVzX29iamVjdCAqb2JqLAogICAgICAgICAgICAgICAgICBzdHJ1Y3QgdWJ1c19yZXF1ZXN0
X2RhdGEgKnJlcSwgY29uc3QgY2hhciAqbWV0aG9kLAogICAgICAgICAgICAgICAgICBzdHJ1Y3Qg
YmxvYl9hdHRyICptc2cpCkBAIC00MTMsMzAgKzQxOSwxMjcgQEAgc3RhdGljIGludCBwcm9jX3Np
Z25hbChzdHJ1Y3QgdWJ1c19jb250ZXh0ICpjdHgsIHN0cnVjdCB1YnVzX29iamVjdCAqb2JqLAog
CXJldHVybiAwOwogfQogCitzdGF0aWMgZW51bSB2anNvbl9zdGF0ZSB2anNvbl9lcnJvcihjaGFy
ICoqYiwgY29uc3QgY2hhciAqZm10LCAuLi4pCit7CisJc3RhdGljIGNoYXIgYnVmWzI1Nl0gPSB7
IDAgfTsKKwljb25zdCBjaGFyICpwZnggPSAiRmlybXdhcmUgaW1hZ2UgY291bGRuJ3QgYmUgdmFs
aWRhdGVkOiAiOworCXZhX2xpc3QgdmE7CisJaW50IHI7CisKKwlyID0gc25wcmludGYoYnVmLCBz
aXplb2YoYnVmKSwgIiVzIiwgcGZ4KTsKKwlpZiAociA8IDApIHsKKwkJKmIgPSAidmpzb25fZXJy
b3IoKSBzbnByaW50ZiBmYWlsZWQiOworCQlyZXR1cm4gVkpTT05fRVJST1I7CisJfQorCisJdmFf
c3RhcnQodmEsIGZtdCk7CisJciA9IHZzbnByaW50ZihidWYrciwgc2l6ZW9mKGJ1ZiktciwgZm10
LCB2YSk7CisJaWYgKHIgPCAwKSB7CisJCSpiID0gInZqc29uX2Vycm9yKCkgdnNucHJpbnRmIGZh
aWxlZCI7CisJCXJldHVybiBWSlNPTl9FUlJPUjsKKwl9CisJdmFfZW5kKHZhKTsKKworCSpiID0g
YnVmOworCXJldHVybiBWSlNPTl9FUlJPUjsKK30KKworc3RhdGljIGVudW0gdmpzb25fc3RhdGUg
dmpzb25fcGFyc2VfdG9rZW4oanNvbl90b2tlbmVyICp0b2ssIGNoYXIgKmJ1Ziwgc3NpemVfdCBs
ZW4sIGNoYXIgKiplcnIpCit7CisJanNvbl9vYmplY3QgKmpzb2JqID0gTlVMTDsKKworCWpzb2Jq
ID0ganNvbl90b2tlbmVyX3BhcnNlX2V4KHRvaywgYnVmLCBsZW4pOworCWlmIChqc29uX3Rva2Vu
ZXJfZ2V0X2Vycm9yKHRvaykgPT0ganNvbl90b2tlbmVyX2NvbnRpbnVlKQorCQlyZXR1cm4gVkpT
T05fQ09OVElOVUU7CisKKwlpZiAoanNvbl90b2tlbmVyX2dldF9lcnJvcih0b2spID09IGpzb25f
dG9rZW5lcl9zdWNjZXNzKSB7CisJCWlmIChqc29uX29iamVjdF9nZXRfdHlwZShqc29iaikgIT0g
anNvbl90eXBlX29iamVjdCkgeworCQkJanNvbl9vYmplY3RfcHV0KGpzb2JqKTsKKwkJCXJldHVy
biB2anNvbl9lcnJvcihlcnIsICJyZXN1bHQgaXMgbm90IGFuIEpTT04gb2JqZWN0Iik7CisJCX0K
KworCQlibG9ibXNnX2FkZF9vYmplY3QoJmIsIGpzb2JqKTsKKwkJanNvbl9vYmplY3RfcHV0KGpz
b2JqKTsKKwkJcmV0dXJuIFZKU09OX1NVQ0NFU1M7CisJfQorCisJcmV0dXJuIHZqc29uX2Vycm9y
KGVyciwgImZhaWxlZCB0byBwYXJzZSBKU09OOiAlcyAoJWQpIiwKKwkJCSAgIGpzb25fdG9rZW5l
cl9lcnJvcl9kZXNjKGpzb25fdG9rZW5lcl9nZXRfZXJyb3IodG9rKSksCisJCQkgICBqc29uX3Rv
a2VuZXJfZ2V0X2Vycm9yKHRvaykpOworfQorCitzdGF0aWMgZW51bSB2anNvbl9zdGF0ZSB2anNv
bl9wYXJzZShpbnQgZmQsIGNoYXIgKiplcnIpCit7CisJZW51bSB2anNvbl9zdGF0ZSByID0gVkpT
T05fRVJST1I7CisJc2l6ZV90IHJlYWRfY291bnQgPSAwOworCWNoYXIgYnVmWzY0XSA9IHsgMCB9
OworCWpzb25fdG9rZW5lciAqdG9rOworCXNzaXplX3QgbGVuOworCWludCBfZXJybm87CisKKwl0
b2sgPSBqc29uX3Rva2VuZXJfbmV3KCk7CisJaWYgKCF0b2spCisJCXJldHVybiB2anNvbl9lcnJv
cihlcnIsICJqc29uX3Rva2VuZXJfbmV3KCkgZmFpbGVkIik7CisKKwl2anNvbl9lcnJvcihlcnIs
ICJpbmNvbXBsZXRlIEpTT04gaW5wdXQiKTsKKworCXdoaWxlICgobGVuID0gcmVhZChmZCwgYnVm
LCBzaXplb2YoYnVmKSkpKSB7CisJCWlmIChsZW4gPCAwICYmIGVycm5vID09IEVJTlRSKQorCQkJ
Y29udGludWU7CisKKwkJaWYgKGxlbiA8IDApIHsKKwkJCV9lcnJubyA9IGVycm5vOworCQkJanNv
bl90b2tlbmVyX2ZyZWUodG9rKTsKKwkJCXJldHVybiB2anNvbl9lcnJvcihlcnIsICJyZWFkKCkg
ZmFpbGVkOiAlcyAoJWQpIiwKKwkJCQkJICAgc3RyZXJyb3IoX2Vycm5vKSwgX2Vycm5vKTsKKwkJ
fQorCisJCXJlYWRfY291bnQgKz0gbGVuOworCQlyID0gdmpzb25fcGFyc2VfdG9rZW4odG9rLCBi
dWYsIGxlbiwgZXJyKTsKKwkJaWYgKHIgIT0gVkpTT05fQ09OVElOVUUpCisJCQlicmVhazsKKwor
CQltZW1zZXQoYnVmLCAwLCBzaXplb2YoYnVmKSk7CisJfQorCisJaWYgKHJlYWRfY291bnQgPT0g
MCkKKwkJdmpzb25fZXJyb3IoZXJyLCAibm8gSlNPTiBpbnB1dCIpOworCisJanNvbl90b2tlbmVy
X2ZyZWUodG9rKTsKKwlyZXR1cm4gcjsKK30KKwogLyoqCiAgKiB2YWxpZGF0ZV9maXJtd2FyZV9p
bWFnZV9jYWxsIC0gcGVyZm9ybSB2YWxpZGF0aW9uICYgc3RvcmUgcmVzdWx0IGluIGdsb2JhbCBi
CiAgKgogICogQGZpbGU6IGZpcm13YXJlIGltYWdlIHBhdGgKICAqLwotc3RhdGljIGludCB2YWxp
ZGF0ZV9maXJtd2FyZV9pbWFnZV9jYWxsKGNvbnN0IGNoYXIgKmZpbGUpCitzdGF0aWMgZW51bSB2
anNvbl9zdGF0ZSB2YWxpZGF0ZV9maXJtd2FyZV9pbWFnZV9jYWxsKGNvbnN0IGNoYXIgKmZpbGUs
IGNoYXIgKiplcnIpCiB7CiAJY29uc3QgY2hhciAqcGF0aCA9ICIvdXNyL2xpYmV4ZWMvdmFsaWRh
dGVfZmlybXdhcmVfaW1hZ2UiOwotCWpzb25fb2JqZWN0ICpqc29iaiA9IE5VTEw7Ci0JanNvbl90
b2tlbmVyICp0b2s7Ci0JY2hhciBidWZbNjRdOwotCXNzaXplX3QgbGVuOworCWVudW0gdmpzb25f
c3RhdGUgcmV0ID0gVkpTT05fRVJST1I7CisJaW50IF9lcnJubzsKIAlpbnQgZmRzWzJdOwotCWlu
dCBlcnI7CiAJaW50IGZkOwogCi0JaWYgKHBpcGUoZmRzKSkKLQkJcmV0dXJuIC1lcnJubzsKKwli
bG9iX2J1Zl9pbml0KCZiLCAwKTsKKwl2anNvbl9lcnJvcihlcnIsICJ1bmhhbmRsZWQgZXJyb3Ii
KTsKKworCWlmIChwaXBlKGZkcykpIHsKKwkJX2Vycm5vID0gZXJybm87CisJCXJldHVybiB2anNv
bl9lcnJvcihlcnIsICJwaXBlKCkgZmFpbGVkOiAlcyAoJWQpIiwKKwkJCQkgICBzdHJlcnJvcihf
ZXJybm8pLCBfZXJybm8pOworCX0KIAogCXN3aXRjaCAoZm9yaygpKSB7CiAJY2FzZSAtMToKKwkJ
X2Vycm5vID0gZXJybm87CisKIAkJY2xvc2UoZmRzWzBdKTsKIAkJY2xvc2UoZmRzWzFdKTsKLQkJ
cmV0dXJuIC1lcnJubzsKKworCQlyZXR1cm4gdmpzb25fZXJyb3IoZXJyLCAiZm9yaygpIGZhaWxl
ZDogJXMgKCVkKSIsCisJCQkJICAgc3RyZXJyb3IoX2Vycm5vKSwgX2Vycm5vKTsKIAljYXNlIDA6
CiAJCS8qIFNldCBzdGRpbiAmIHN0ZGVyciB0byAvZGV2L251bGwgKi8KIAkJZmQgPSBvcGVuKCIv
ZGV2L251bGwiLCBPX1JEV1IpOwpAQCAtNDU4LDQzICs1NjEsMTAgQEAgc3RhdGljIGludCB2YWxp
ZGF0ZV9maXJtd2FyZV9pbWFnZV9jYWxsKGNvbnN0IGNoYXIgKmZpbGUpCiAJLyogUGFyZW50IHBy
b2Nlc3MgKi8KIAljbG9zZShmZHNbMV0pOwogCi0JdG9rID0ganNvbl90b2tlbmVyX25ldygpOwot
CWlmICghdG9rKSB7Ci0JCWNsb3NlKGZkc1swXSk7Ci0JCXJldHVybiAtRU5PTUVNOwotCX0KLQot
CWJsb2JfYnVmX2luaXQoJmIsIDApOwotCXdoaWxlICgobGVuID0gcmVhZChmZHNbMF0sIGJ1Ziwg
c2l6ZW9mKGJ1ZikpKSkgewotCQlpZiAobGVuIDwgMCAmJiBlcnJubyA9PSBFSU5UUikKLQkJCWNv
bnRpbnVlOwotCi0JCWpzb2JqID0ganNvbl90b2tlbmVyX3BhcnNlX2V4KHRvaywgYnVmLCBsZW4p
OwotCi0JCWlmIChqc29uX3Rva2VuZXJfZ2V0X2Vycm9yKHRvaykgPT0ganNvbl90b2tlbmVyX3N1
Y2Nlc3MpCi0JCQlicmVhazsKLQkJZWxzZSBpZiAoanNvbl90b2tlbmVyX2dldF9lcnJvcih0b2sp
ID09IGpzb25fdG9rZW5lcl9jb250aW51ZSkKLQkJCWNvbnRpbnVlOwotCQllbHNlCi0JCQlmcHJp
bnRmKHN0ZGVyciwgIkZhaWxlZCB0byBwYXJzZSBKU09OOiAlZFxuIiwKLQkJCQlqc29uX3Rva2Vu
ZXJfZ2V0X2Vycm9yKHRvaykpOwotCX0KLQorCXJldCA9IHZqc29uX3BhcnNlKGZkc1swXSwgZXJy
KTsKIAljbG9zZShmZHNbMF0pOwogCi0JZXJyID0gLUVOT0VOVDsKLQlpZiAoanNvYmopIHsKLQkJ
aWYgKGpzb25fb2JqZWN0X2dldF90eXBlKGpzb2JqKSA9PSBqc29uX3R5cGVfb2JqZWN0KSB7Ci0J
CQlibG9ibXNnX2FkZF9vYmplY3QoJmIsIGpzb2JqKTsKLQkJCWVyciA9IDA7Ci0JCX0KLQotCQlq
c29uX29iamVjdF9wdXQoanNvYmopOwotCX0KLQotCWpzb25fdG9rZW5lcl9mcmVlKHRvayk7Ci0K
LQlyZXR1cm4gZXJyOworCXJldHVybiByZXQ7CiB9CiAKIGVudW0gewpAQCAtNTEyLDYgKzU4Miw4
IEBAIHN0YXRpYyBpbnQgdmFsaWRhdGVfZmlybXdhcmVfaW1hZ2Uoc3RydWN0IHVidXNfY29udGV4
dCAqY3R4LAogCQkJCSAgIGNvbnN0IGNoYXIgKm1ldGhvZCwgc3RydWN0IGJsb2JfYXR0ciAqbXNn
KQogewogCXN0cnVjdCBibG9iX2F0dHIgKnRiW19fVkFMSURBVEVfRklSTVdBUkVfSU1BR0VfTUFY
XTsKKwllbnVtIHZqc29uX3N0YXRlIHJldCA9IFZKU09OX0VSUk9SOworCWNoYXIgKmVycjsKIAog
CWlmICghbXNnKQogCQlyZXR1cm4gVUJVU19TVEFUVVNfSU5WQUxJRF9BUkdVTUVOVDsKQEAgLTUy
MCw3ICs1OTIsOCBAQCBzdGF0aWMgaW50IHZhbGlkYXRlX2Zpcm13YXJlX2ltYWdlKHN0cnVjdCB1
YnVzX2NvbnRleHQgKmN0eCwKIAlpZiAoIXRiW1ZBTElEQVRFX0ZJUk1XQVJFX0lNQUdFX1BBVEhd
KQogCQlyZXR1cm4gVUJVU19TVEFUVVNfSU5WQUxJRF9BUkdVTUVOVDsKIAotCWlmICh2YWxpZGF0
ZV9maXJtd2FyZV9pbWFnZV9jYWxsKGJsb2Jtc2dfZ2V0X3N0cmluZyh0YltWQUxJREFURV9GSVJN
V0FSRV9JTUFHRV9QQVRIXSkpKQorCXJldCA9IHZhbGlkYXRlX2Zpcm13YXJlX2ltYWdlX2NhbGwo
YmxvYm1zZ19nZXRfc3RyaW5nKHRiW1ZBTElEQVRFX0ZJUk1XQVJFX0lNQUdFX1BBVEhdKSwgJmVy
cik7CisJaWYgKHJldCAhPSBWSlNPTl9TVUNDRVNTKQogCQlyZXR1cm4gVUJVU19TVEFUVVNfVU5L
Tk9XTl9FUlJPUjsKIAogCXVidXNfc2VuZF9yZXBseShjdHgsIHJlcSwgYi5oZWFkKTsKQEAgLTU4
MCw2ICs2NTMsOCBAQCBzdGF0aWMgaW50IHN5c3VwZ3JhZGUoc3RydWN0IHVidXNfY29udGV4dCAq
Y3R4LCBzdHJ1Y3QgdWJ1c19vYmplY3QgKm9iaiwKIAlzdHJ1Y3QgYmxvYl9hdHRyICp2YWxpZGF0
aW9uW19fVkFMSURBVElPTl9NQVhdOwogCXN0cnVjdCBibG9iX2F0dHIgKnRiW19fU1lTVVBHUkFE
RV9NQVhdOwogCWJvb2wgdmFsaWQsIGZvcmNlYWJsZSwgYWxsb3dfYmFja3VwOworCWVudW0gdmpz
b25fc3RhdGUgcmV0ID0gVkpTT05fRVJST1I7CisJY2hhciAqZXJyOwogCiAJaWYgKCFtc2cpCiAJ
CXJldHVybiBVQlVTX1NUQVRVU19JTlZBTElEX0FSR1VNRU5UOwpAQCAtNTg4LDggKzY2Myw5IEBA
IHN0YXRpYyBpbnQgc3lzdXBncmFkZShzdHJ1Y3QgdWJ1c19jb250ZXh0ICpjdHgsIHN0cnVjdCB1
YnVzX29iamVjdCAqb2JqLAogCWlmICghdGJbU1lTVVBHUkFERV9QQVRIXSB8fCAhdGJbU1lTVVBH
UkFERV9QUkVGSVhdKQogCQlyZXR1cm4gVUJVU19TVEFUVVNfSU5WQUxJRF9BUkdVTUVOVDsKIAot
CWlmICh2YWxpZGF0ZV9maXJtd2FyZV9pbWFnZV9jYWxsKGJsb2Jtc2dfZ2V0X3N0cmluZyh0YltT
WVNVUEdSQURFX1BBVEhdKSkpIHsKLQkJc3lzdXBncmFkZV9lcnJvcihjdHgsIHJlcSwgIkZpcm13
YXJlIGltYWdlIGNvdWxkbid0IGJlIHZhbGlkYXRlZCIpOworCXJldCA9IHZhbGlkYXRlX2Zpcm13
YXJlX2ltYWdlX2NhbGwoYmxvYm1zZ19nZXRfc3RyaW5nKHRiW1NZU1VQR1JBREVfUEFUSF0pLCAm
ZXJyKTsKKwlpZiAocmV0ICE9IFZKU09OX1NVQ0NFU1MpIHsKKwkJc3lzdXBncmFkZV9lcnJvcihj
dHgsIHJlcSwgZXJyKTsKIAkJcmV0dXJuIFVCVVNfU1RBVFVTX1VOS05PV05fRVJST1I7CiAJfQog
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpvcGVud3J0
LWRldmVsIG1haWxpbmcgbGlzdApvcGVud3J0LWRldmVsQGxpc3RzLm9wZW53cnQub3JnCmh0dHBz
Oi8vbGlzdHMub3BlbndydC5vcmcvbWFpbG1hbi9saXN0aW5mby9vcGVud3J0LWRldmVsCg==
